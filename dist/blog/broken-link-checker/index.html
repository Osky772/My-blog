<!DOCTYPE html><html lang="pl" data-astro-cid-sckkx6r4> <head><meta charset="UTF-8"><meta name="description" content="Blog Oskara KowalÃ³w o programowaniu"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="icon" type="image/svg+xml" href="/favicon.svg"><link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet"><title>Broken Link Checker - znajdÅº popsute linki na stronie</title><style>:root{--color-text: #2d3748;--color-heading: #1a202c;--color-primary: #6366f1;--color-primary-hover: #4f46e5;--color-muted: #718096;--color-border: #e2e8f0;--color-background: #ffffff;--color-surface: #f7fafc;--font-size-xs: .75rem;--font-size-sm: .875rem;--font-size-base: 1rem;--font-size-lg: 1.125rem;--font-size-xl: 1.25rem;--font-size-2xl: 1.5rem;--font-size-3xl: 1.875rem;--font-size-4xl: 2.25rem;--spacing-1: .25rem;--spacing-2: .5rem;--spacing-3: .75rem;--spacing-4: 1rem;--spacing-6: 1.5rem;--spacing-8: 2rem;--spacing-12: 3rem;--spacing-16: 4rem;--spacing-20: 5rem}[data-astro-cid-sckkx6r4]{box-sizing:border-box}html{scroll-behavior:smooth}body{font-family:Inter,system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,sans-serif;font-weight:400;line-height:1.6;color:var(--color-text);background-color:var(--color-background);margin:0;padding:0;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}.container[data-astro-cid-sckkx6r4]{max-width:65ch;margin:0 auto;padding:0 var(--spacing-6);min-height:100vh;display:flex;flex-direction:column}header[data-astro-cid-sckkx6r4]{padding:var(--spacing-8) 0 var(--spacing-12) 0}nav[data-astro-cid-sckkx6r4]{display:flex;justify-content:space-between;align-items:center}.logo[data-astro-cid-sckkx6r4]{font-size:var(--font-size-xl);font-weight:600;color:var(--color-heading);text-decoration:none;transition:color .2s ease}.logo[data-astro-cid-sckkx6r4]:hover{color:var(--color-primary)}.nav-links[data-astro-cid-sckkx6r4]{display:flex;gap:var(--spacing-8)}.nav-links[data-astro-cid-sckkx6r4] a[data-astro-cid-sckkx6r4]{color:var(--color-muted);text-decoration:none;font-weight:500;font-size:var(--font-size-base);transition:color .2s ease;position:relative}.nav-links[data-astro-cid-sckkx6r4] a[data-astro-cid-sckkx6r4]:hover{color:var(--color-heading)}.nav-links[data-astro-cid-sckkx6r4] a[data-astro-cid-sckkx6r4]:after{content:"";position:absolute;bottom:-4px;left:0;width:0;height:2px;background-color:var(--color-primary);transition:width .2s ease}.nav-links[data-astro-cid-sckkx6r4] a[data-astro-cid-sckkx6r4]:hover:after{width:100%}main[data-astro-cid-sckkx6r4]{flex:1;padding-bottom:var(--spacing-16)}footer[data-astro-cid-sckkx6r4]{border-top:1px solid var(--color-border);padding:var(--spacing-8) 0;margin-top:auto}.footer-content[data-astro-cid-sckkx6r4]{display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:var(--spacing-4)}.footer-content[data-astro-cid-sckkx6r4] p[data-astro-cid-sckkx6r4]{margin:0;color:var(--color-muted);font-size:var(--font-size-sm)}.social-links[data-astro-cid-sckkx6r4]{display:flex;gap:var(--spacing-4)}.social-links[data-astro-cid-sckkx6r4] a[data-astro-cid-sckkx6r4]{color:var(--color-muted);text-decoration:none;font-size:var(--font-size-sm);transition:color .2s ease}.social-links[data-astro-cid-sckkx6r4] a[data-astro-cid-sckkx6r4]:hover{color:var(--color-primary)}@media (max-width: 640px){.container[data-astro-cid-sckkx6r4]{padding:0 var(--spacing-4)}header[data-astro-cid-sckkx6r4]{padding:var(--spacing-6) 0 var(--spacing-8) 0}nav[data-astro-cid-sckkx6r4]{flex-direction:column;gap:var(--spacing-4);align-items:flex-start}.footer-content[data-astro-cid-sckkx6r4]{flex-direction:column;align-items:flex-start;gap:var(--spacing-2)}}
</style>
<link rel="stylesheet" href="/_astro/_slug_.Cu7iYPMV.css"></head> <body data-astro-cid-sckkx6r4> <div class="container" data-astro-cid-sckkx6r4> <header data-astro-cid-sckkx6r4> <nav data-astro-cid-sckkx6r4> <a href="/" class="logo" data-astro-cid-sckkx6r4>Oskar KowalÃ³w</a> <div class="nav-links" data-astro-cid-sckkx6r4> <a href="/blog" data-astro-cid-sckkx6r4>Blog</a> </div> </nav> </header> <main data-astro-cid-sckkx6r4>  <article data-astro-cid-7jjqptxk> <header class="post-header" data-astro-cid-7jjqptxk> <h1 class="post-title" data-astro-cid-7jjqptxk>Broken Link Checker - znajdÅº popsute linki na stronie</h1> <div class="post-meta" data-astro-cid-7jjqptxk> <time class="post-date" data-astro-cid-7jjqptxk>26 kwietnia 2021</time> <div class="post-tags" data-astro-cid-7jjqptxk> <span class="post-tag" data-astro-cid-7jjqptxk>npm</span> </div> </div> </header> <div class="post-content" data-astro-cid-7jjqptxk> <p>Z pewnoÅ›ciÄ… nie chciaÅ‚byÅ›, aby na twojej stronie byÅ‚y niedziaÅ‚ajÄ…ce linki lub prowadzÄ…ce do strony, ktÃ³ra nie istnieje. W przypadku maÅ‚ej strony moÅ¼na rÄ™cznie sprawdziÄ‡, czy wszystkie linki dziaÅ‚ajÄ…, ale na wiÄ™kszych stronach nie bÄ™dzie to takie proste. Poza tym, jako programiÅ›ci powinniÅ›my automatyzowaÄ‡ powtarzalne czynnoÅ›ci ğŸ™‚</p>
<p><img src="/images/broken-link-checker/404-error.jpeg" alt="BÅ‚Ä…d 404"></p>
<p>UÅ¼yjemy bardzo fajnej biblioteki do sprawdzania popsutych linkÃ³w, a jest to <a href="https://github.com/stevenvachon/broken-link-checker">Broken Link Checker</a>.</p>
<p>Ostatnio w pracy miaÅ‚em okazjÄ™ skorzystaÄ‡ z tej biblioteki. ZaimplementowaÅ‚em sprawdzanie wszystkich linkÃ³w w dokumentacji naszego produktu. Ostatecznie napisany skrypt jest bardzo prosty. Najpierw dokumentacja jest budowana, nastÄ™pnie uruchamiany jest <a href="https://github.com/http-party/http-server">http-server</a> w folderze z bundlem aplikacji, i w koÅ„cu uruchamiane jest skanowanie linkÃ³w na tej stronie.</p>
<p>BibliotekÄ™ moÅ¼emy uÅ¼ywaÄ‡ na dwa sposoby: w wierszu poleceÅ„ oraz w kodzie poprzez API. ZaprezentujÄ™ obie opcje.</p>
<blockquote>
<p><strong>Instalacja:</strong> Musimy mieÄ‡ <a href="https://www.npmjs.com/get-npm">zainstalowany NPM</a> oraz Node w wersji wiekszej lub rÃ³wnej 14.</p>
</blockquote>
<h3 id="uÅ¼ycie-w-wierszu-poleceÅ„">UÅ¼ycie w wierszu poleceÅ„</h3>
<p>W celu uÅ¼ycia biblioteki w wierszu poleceÅ„, zainstalujmy jÄ… globalnie:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="shell"><code><span class="line"><span style="color:#B392F0">npm</span><span style="color:#9ECBFF"> install</span><span style="color:#9ECBFF"> broken-link-checker</span><span style="color:#79B8FF"> -g</span></span>
<span class="line"></span></code></pre>
<p>JeÅ›li instalacja powiodÅ‚a siÄ™, moÅ¼emy sprawdziÄ‡ dostÄ™pne argumenty:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="shell"><code><span class="line"><span style="color:#B392F0">blc</span><span style="color:#79B8FF"> --help</span></span>
<span class="line"></span></code></pre>
<p>Typowe uÅ¼ycie w celu przeskanowania caÅ‚ej strony moÅ¼e wyglÄ…daÄ‡ nastÄ™pujÄ…co:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="shell"><code><span class="line"><span style="color:#6A737D"># -r skanuje rekurencyjnie caÅ‚Ä… stronÄ™, czyli rÃ³wnieÅ¼ wszystkie podstrony</span></span>
<span class="line"><span style="color:#6A737D"># -o zachowuje kolejnoÅ›Ä‡ linkÃ³w w jakiej pojawiajÄ… siÄ™ na stronie</span></span>
<span class="line"><span style="color:#B392F0">blc</span><span style="color:#9ECBFF"> https://www.oskarkowalow.pl</span><span style="color:#79B8FF"> -ro</span></span>
<span class="line"></span></code></pre>
<p>PowyÅ¼szy skrypt uruchomi skanowanie strony internetowej. Tak wyglÄ…da fragment skanowania mojej strony:</p>
<p><img src="/images/broken-link-checker/blc-scanning.png" alt="Skanowanie broken link checker"></p>
<p>Wynik skanowania jest bardzo czytelny i wiadomo, ktÃ³re linki dziaÅ‚ajÄ…, a ktÃ³re nie. WidaÄ‡ jednak, Å¼e linki prowadzÄ…ce do Linkedin wyrzucajÄ… bÅ‚Ä…d. To zachowanie jest nie do ominiÄ™cia i linki prowadzÄ…ce do Linkedin zawsze bÄ™dÄ… zwracaÄ‡ ten bÅ‚Ä…d.</p>
<p>U mnie tak wyglÄ…da wynik zakoÅ„czenia skanowania:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="plaintext"><code><span class="line"><span>Finished! 682 links found. 578 excluded. 18 broken.</span></span>
<span class="line"><span>Elapsed time: 49 seconds</span></span>
<span class="line"><span></span></span></code></pre>
<p>Moja strona jest jeszcze doÅ›Ä‡ maÅ‚a i skanowanie wszystkich podstron nie byÅ‚o zbyt czasochÅ‚onne.</p>
<h4 id="pomijanie-linkÃ³w">Pomijanie linkÃ³w</h4>
<p>MoÅ¼emy pomijaÄ‡ skanowanie wybranych linkÃ³w, aby przyspieszyÄ‡ skanowanie lub pozbyÄ‡ siÄ™ linkÃ³w, ktÃ³re zawsze zwracajÄ… bÅ‚Ä…d:</p>
<ul>
<li><code>--exclude-external</code> lub <code>-e</code> spowoduje pominiÄ™cie wszystkich linkÃ³w do zewnÄ™trznych serwisÃ³w,</li>
<li><code>--exclude-internal</code> lub <code>-i</code> spowoduje pominiÄ™cie wszystkich wewnÄ™trznych linkÃ³w, a wiÄ™c bÄ™dzie sprawdzaÄ‡ tylko zewnÄ™trzne linki,</li>
<li><code>--exclude</code> pozwala na pomijanie rÃ³Å¼nych Å›cieÅ¼ek i wybranych linkÃ³w.</li>
</ul>
<p>Tak moÅ¼e wyglÄ…daÄ‡ pominiÄ™cie linkÃ³w do Linkedin oraz podstrony â€œblog/kategorieâ€:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="shell"><code><span class="line"><span style="color:#B392F0">blc</span><span style="color:#9ECBFF"> https://www.oskarkowalow.pl</span><span style="color:#79B8FF"> -ro</span><span style="color:#79B8FF"> \</span></span>
<span class="line"><span style="color:#E1E4E8">--exclude </span><span style="color:#9ECBFF">linkedin</span><span style="color:#79B8FF"> \</span></span>
<span class="line"><span style="color:#E1E4E8">--exclude </span><span style="color:#9ECBFF">/blog/kategorie</span></span>
<span class="line"></span></code></pre>
<h4 id="skanowanie-tylko-jednej-strony">Skanowanie tylko jednej strony</h4>
<p>Czasem skanowanie wszystkich podstron moÅ¼e byÄ‡ bardzo czasochÅ‚onne, szczegÃ³lnie jeÅ¼eli mamy bardzo duÅ¼y serwis do sprawdzenia. W takim wypadku wystarczy odjÄ…Ä‡ flagÄ™ <code>-r</code>:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="shell"><code><span class="line"><span style="color:#B392F0">blc</span><span style="color:#9ECBFF"> https://www.oskarkowalow.pl</span><span style="color:#79B8FF"> -o</span></span>
<span class="line"></span></code></pre>
<h3 id="uÅ¼ycie-w-kodzie">UÅ¼ycie w kodzie</h3>
<p>Biblioteka udostÄ™pnia API, dziÄ™ki czemu moÅ¼emy uÅ¼yÄ‡ jej w kodzie. PrzykÅ‚adowo, moÅ¼emy napisaÄ‡ skrypt w Node JS, ktÃ³ry bÄ™dzie sprawdzaÅ‚ wybrane linki na stronie zanim pÃ³jdzie ona na produkcjÄ™. MoÅ¼e to byÄ‡ kolejny krok w ramach testÃ³w w naszym <em>Continues Integration</em>.</p>
<p>Zainstalujemy bibliotekÄ™ lokalnie, wewnÄ…trz naszego projektu:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="shell"><code><span class="line"><span style="color:#6A737D"># instalujemy jako dev dependencjÄ™, gdyÅ¼ jest potrzebna tylko podczas developmentu</span></span>
<span class="line"><span style="color:#B392F0">npm</span><span style="color:#9ECBFF"> install</span><span style="color:#79B8FF"> --save-dev</span><span style="color:#9ECBFF"> broken-link-checker</span></span>
<span class="line"></span></code></pre>
<p>StwÃ³rzmy nowy plik w ktÃ³rym umieÅ›cimy caÅ‚y nasz kod dotyczÄ…cy skanowania wybranego URL:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#6A737D">// check-links.js</span></span>
<span class="line"><span style="color:#F97583">const</span><span style="color:#E1E4E8"> { </span><span style="color:#79B8FF">SiteChecker</span><span style="color:#E1E4E8"> } </span><span style="color:#F97583">=</span><span style="color:#B392F0"> require</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"broken-link-checker"</span><span style="color:#E1E4E8">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> siteChecker</span><span style="color:#F97583"> =</span><span style="color:#F97583"> new</span><span style="color:#B392F0"> SiteChecker</span><span style="color:#E1E4E8">(</span></span>
<span class="line"><span style="color:#E1E4E8">  { </span></span>
<span class="line"><span style="color:#E1E4E8">    excludeInternalLinks: </span><span style="color:#79B8FF">false</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">    excludeExternalLinks: </span><span style="color:#79B8FF">false</span><span style="color:#E1E4E8">, </span></span>
<span class="line"><span style="color:#E1E4E8">    filterLevel: </span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">    excludedKeywords: [</span><span style="color:#9ECBFF">"linkedin.com"</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">"github.com"</span><span style="color:#E1E4E8">]</span></span>
<span class="line"><span style="color:#E1E4E8">  },</span></span>
<span class="line"><span style="color:#E1E4E8">  {</span></span>
<span class="line"><span style="color:#9ECBFF">    "error"</span><span style="color:#E1E4E8">: (</span><span style="color:#FFAB70">error</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#E1E4E8">        console.</span><span style="color:#B392F0">error</span><span style="color:#E1E4E8">(error);</span></span>
<span class="line"><span style="color:#E1E4E8">    },</span></span>
<span class="line"><span style="color:#9ECBFF">    "link"</span><span style="color:#E1E4E8">: (</span><span style="color:#FFAB70">result</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">      if</span><span style="color:#E1E4E8"> (result.broken) {</span></span>
<span class="line"><span style="color:#F97583">        if</span><span style="color:#E1E4E8"> (result.http.response </span><span style="color:#F97583">&#x26;&#x26;</span><span style="color:#F97583"> !</span><span style="color:#E1E4E8">[</span><span style="color:#79B8FF">undefined</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">200</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">429</span><span style="color:#E1E4E8">].</span><span style="color:#B392F0">includes</span><span style="color:#E1E4E8">(result.http.response.statusCode)) {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">          if</span><span style="color:#E1E4E8"> (result.internal) {</span></span>
<span class="line"><span style="color:#E1E4E8">            console.</span><span style="color:#B392F0">error</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">`broken internal link ${</span><span style="color:#E1E4E8">result</span><span style="color:#9ECBFF">.</span><span style="color:#E1E4E8">http</span><span style="color:#9ECBFF">.</span><span style="color:#E1E4E8">response</span><span style="color:#9ECBFF">.</span><span style="color:#E1E4E8">statusCode</span><span style="color:#9ECBFF">} => ${</span><span style="color:#E1E4E8">result</span><span style="color:#9ECBFF">.</span><span style="color:#E1E4E8">url</span><span style="color:#9ECBFF">.</span><span style="color:#E1E4E8">original</span><span style="color:#9ECBFF">} on page ${</span><span style="color:#E1E4E8">result</span><span style="color:#9ECBFF">.</span><span style="color:#E1E4E8">base</span><span style="color:#9ECBFF">.</span><span style="color:#E1E4E8">resolved</span><span style="color:#9ECBFF">}`</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">          } </span><span style="color:#F97583">else</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#E1E4E8">            console.</span><span style="color:#B392F0">warn</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">`broken external link ${</span><span style="color:#E1E4E8">result</span><span style="color:#9ECBFF">.</span><span style="color:#E1E4E8">http</span><span style="color:#9ECBFF">.</span><span style="color:#E1E4E8">response</span><span style="color:#9ECBFF">.</span><span style="color:#E1E4E8">statusCode</span><span style="color:#9ECBFF">} => ${</span><span style="color:#E1E4E8">result</span><span style="color:#9ECBFF">.</span><span style="color:#E1E4E8">url</span><span style="color:#9ECBFF">.</span><span style="color:#E1E4E8">original</span><span style="color:#9ECBFF">} on page ${</span><span style="color:#E1E4E8">result</span><span style="color:#9ECBFF">.</span><span style="color:#E1E4E8">base</span><span style="color:#9ECBFF">.</span><span style="color:#E1E4E8">resolved</span><span style="color:#9ECBFF">}`</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">          }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">        }</span></span>
<span class="line"><span style="color:#E1E4E8">      }</span></span>
<span class="line"><span style="color:#E1E4E8">    },</span></span>
<span class="line"><span style="color:#9ECBFF">    "end"</span><span style="color:#E1E4E8">: () </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#E1E4E8">        console.</span><span style="color:#B392F0">log</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"CHECK FOR BROKEN LINKS FINISHED!"</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">  }</span></span>
<span class="line"><span style="color:#E1E4E8">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">siteChecker.</span><span style="color:#B392F0">enqueue</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"http://localhost:8000/"</span><span style="color:#E1E4E8">);</span></span>
<span class="line"></span>
<span class="line"></span></code></pre>
<p>Teraz przeÅ›ledzimy sobie co dziejÄ™ siÄ™ w powyÅ¼szym kodzie.</p>
<p>Importujemy klasÄ™ <code>SiteChecker</code> i tworzymy jej nowÄ… instancjÄ™ z obiektem konfiguracyjnym i eventami, na ktÃ³re chcemy nasÅ‚uchiwaÄ‡.</p>
<p>Chcemy skanowaÄ‡ linki wewnÄ™trzne, czyli naleÅ¼Ä…ce do naszej strony (ktÃ³rÄ… w linii 33 bÄ™dziemy nasÅ‚uchiwaÄ‡, czyli wywoÅ‚amy na naszym URL skanowanie) oraz linki zewnÄ™trze, czyli nie naleÅ¼Ä…ce do naszego serwisu, np. google.com itd.</p>
<p>NastÄ™pnie wybieramy poziom <a href="https://github.com/stevenvachon/broken-link-checker#filterlevel">filtrowania</a>, ktÃ³ry ustawiliÅ›my na 0, tzn., chcemy skanowaÄ‡ tylko tagi <code>a</code> oraz <code>area</code>, ktÃ³re muszÄ… zawieraÄ‡ atrybut <code>href</code>.</p>
<p>Jest kilka linkÃ³w, ktÃ³rych nie chcemy skanowaÄ‡, a bÄ™dzie to Linkedin (ktÃ³ry zawsze wyrzuci bÅ‚Ä…d) oraz Github, ktÃ³ry prÄ™dko zacznie wyrzucaÄ‡ bÅ‚Ä…d <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/429">429</a>. W <code>excludedKeywords</code> moÅ¼emy teÅ¼ uÅ¼ywaÄ‡ <em>glob patterns</em> (ale nie wszystkich) z uÅ¼yciem biblioteki <a href="https://www.npmjs.com/package/matcher">matcher</a>.</p>
<p>NastÄ™pnie zdefiniowaliÅ›my eventy na ktÃ³re chcemy nasÅ‚uchiwaÄ‡. Jest ich sporo, ale nas najbardziej interesujÄ… tylko trzy: <code>error</code>, <code>link</code> i <code>end</code>.</p>
<p>Event <code>link</code> zostanie wyemitowany za kaÅ¼dym razem, gdy skanowanie linku zakoÅ„czy siÄ™. WewnÄ…trz tego eventu mamy dostÄ™p do informacji o przeprowadzonym skanowaniu, w tym o sukcesie lub bÅ‚Ä™dzie:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#9ECBFF">"link"</span><span style="color:#E1E4E8">: (</span><span style="color:#FFAB70">result</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">  if</span><span style="color:#E1E4E8"> (result.broken) {</span></span>
<span class="line"><span style="color:#F97583">    if</span><span style="color:#E1E4E8"> (result.http.response </span><span style="color:#F97583">&#x26;&#x26;</span><span style="color:#F97583"> !</span><span style="color:#E1E4E8">[</span><span style="color:#79B8FF">undefined</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">200</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">429</span><span style="color:#E1E4E8">].</span><span style="color:#B392F0">includes</span><span style="color:#E1E4E8">(result.http.response.statusCode)) {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">      if</span><span style="color:#E1E4E8"> (result.internal) {</span></span>
<span class="line"><span style="color:#E1E4E8">        console.</span><span style="color:#B392F0">error</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">`broken internal link ${</span><span style="color:#E1E4E8">result</span><span style="color:#9ECBFF">.</span><span style="color:#E1E4E8">http</span><span style="color:#9ECBFF">.</span><span style="color:#E1E4E8">response</span><span style="color:#9ECBFF">.</span><span style="color:#E1E4E8">statusCode</span><span style="color:#9ECBFF">} => ${</span><span style="color:#E1E4E8">result</span><span style="color:#9ECBFF">.</span><span style="color:#E1E4E8">url</span><span style="color:#9ECBFF">.</span><span style="color:#E1E4E8">original</span><span style="color:#9ECBFF">} on page ${</span><span style="color:#E1E4E8">result</span><span style="color:#9ECBFF">.</span><span style="color:#E1E4E8">base</span><span style="color:#9ECBFF">.</span><span style="color:#E1E4E8">resolved</span><span style="color:#9ECBFF">}`</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">      } </span><span style="color:#F97583">else</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#E1E4E8">        console.</span><span style="color:#B392F0">warn</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">`broken external link ${</span><span style="color:#E1E4E8">result</span><span style="color:#9ECBFF">.</span><span style="color:#E1E4E8">http</span><span style="color:#9ECBFF">.</span><span style="color:#E1E4E8">response</span><span style="color:#9ECBFF">.</span><span style="color:#E1E4E8">statusCode</span><span style="color:#9ECBFF">} => ${</span><span style="color:#E1E4E8">result</span><span style="color:#9ECBFF">.</span><span style="color:#E1E4E8">url</span><span style="color:#9ECBFF">.</span><span style="color:#E1E4E8">original</span><span style="color:#9ECBFF">} on page ${</span><span style="color:#E1E4E8">result</span><span style="color:#9ECBFF">.</span><span style="color:#E1E4E8">base</span><span style="color:#9ECBFF">.</span><span style="color:#E1E4E8">resolved</span><span style="color:#9ECBFF">}`</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">      }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">  }</span></span>
<span class="line"><span style="color:#E1E4E8">},</span></span>
<span class="line"></span></code></pre>
<p>W zasadzie wystarczajÄ…ca moÅ¼e byÄ‡ informacja, Å¼e link jest zepsuty, ale chcemy jeszcze przefiltrowaÄ‡ informacje sprawdzajÄ…c <code>statusCode</code>. Status <code>200</code> nigdy nie powinien siÄ™ tutaj pojawiÄ‡, ale <code>undefined</code> juÅ¼ moÅ¼e. Dodatkowo wykluczymy sobie status <code>429</code> o ktÃ³rym juÅ¼ wspominaÅ‚em.</p>
<p>Dodatkowo dla zepsutych linkÃ³w wewnÄ™trznych chcemy uÅ¼yÄ‡ <code>console.error</code>, a dla zewnÄ™trznych <code>console.warn</code>, aby zaznaczyÄ‡, Å¼e najwaÅ¼niejsze dla nas sÄ… dziaÅ‚ajÄ…ce linki wewnÄ™trzne. W logach zawieramy informacjÄ™ o <code>statusCode</code>, linku ktÃ³ry jest zepsuty <code>result.url.original</code> oraz na stronie na ktÃ³rej znajduje siÄ™ ten link <code>result.base.resolved</code>.</p>
<blockquote>
<p>Nie kaÅ¼dy terminal bÄ™dzie pokazywaÅ‚ poprawne kolory. <code>console.error</code> i <code>console.warn</code> mogÄ… mieÄ‡ biaÅ‚y font, a nie czerwony i Å¼Ã³Å‚ty, ktÃ³rych siÄ™ spodziewamy. W celu zapewnienia takiego samego zachowania dla wszystkich programÃ³w, moÅ¼emy posÅ‚uÅ¼yÄ‡ siÄ™ bibliotekÄ… <a href="https://github.com/chalk/chalk">chalk</a>.</p>
</blockquote>
<p>Event <code>end</code> zostanie wyemitowany po ostatnim przeskanowym linku.</p>
<p>PrzykÅ‚adowo, w evencie <code>link</code> moÅ¼emy dodawaÄ‡ wszystkie popsute linki do tablicy, a nastÄ™pnie w evencie <code>end</code> wyÅ›wietliÄ‡ w konsoli caÅ‚kowitÄ… iloÅ›Ä‡ zepsutych linkÃ³w wewnÄ™trznych i zewnÄ™trznych.</p>
<p>Teraz moÅ¼emy uruchomiÄ‡ nasz nowy plik <code>check-links.js</code>:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="shell"><code><span class="line"><span style="color:#B392F0">node</span><span style="color:#9ECBFF"> check-links.js</span></span>
<span class="line"></span></code></pre>
<h3 id="podsumowanie">Podsumowanie</h3>
<p>PokazaÅ‚em Ci uÅ¼ycie biblioteki Broken Link Checker w CLI oraz w kodzie. Jak widaÄ‡, jest to bardzo przydatna biblioteka. Warto od czasu do czasu sprawdziÄ‡, czy na naszej stronie wszystko dziaÅ‚a, a jeszcze lepiej dodaÄ‡ taki skrypt do naszego CI.</p>
<p>Zapraszam do komentowania i dzielenia siÄ™ swoimi przemyÅ›leniami ğŸ™‚</p> </div> </article>  </main> <footer data-astro-cid-sckkx6r4> <div class="footer-content" data-astro-cid-sckkx6r4> <p data-astro-cid-sckkx6r4>&copy; 2024 Oskar KowalÃ³w</p> <div class="social-links" data-astro-cid-sckkx6r4> <a href="https://www.linkedin.com/in/oskar-kowalow/" target="_blank" rel="noopener noreferrer" data-astro-cid-sckkx6r4>LinkedIn</a> <a href="https://github.com/Osky772" target="_blank" rel="noopener noreferrer" data-astro-cid-sckkx6r4>GitHub</a> </div> </div> </footer> </div> </body></html> 